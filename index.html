<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Admin Panel - Smile Center</title>
</head>
<body>
Â  Â  <div id="app"></div>
Â  Â Â 
Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
Â  Â  Â  Â  import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
Â  Â  Â  Â  import { getStorage, ref, uploadBytesResumable, getDownloadURL, listAll, getMetadata, deleteObject } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
Â  Â  Â  Â  import { getFirestore, collection, getDocs, updateDoc, doc, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyBOmZxS75qIodscsge-gHYuUlb2vCvl0ZM",
Â  Â  Â  Â  Â  Â  authDomain: "smile-center-7c6f5.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "smile-center-7c6f5",
Â  Â  Â  Â  Â  Â  storageBucket: "smile-center-7c6f5.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "517098616907",
Â  Â  Â  Â  Â  Â  appId: "1:517098616907:web:6e321d280049cd67c1b5ce"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const auth = getAuth(app);
Â  Â  Â  Â  const storage = getStorage(app);
Â  Â  Â  Â  const db = getFirestore(app);

Â  Â  Â  Â  let currentUser = null;
Â  Â  Â  Â  let allProjects = [];

Â  Â  Â  Â  // --- HARDCODED DESIGNER LIST (Used for dropdown options) ---
Â  Â  Â  Â  const designers = [
Â  Â  Â  Â  Â  Â  { email: 'designer1@smile.com', name: 'Designer 1' },
Â  Â  Â  Â  Â  Â  { email: 'designer2@smile.com', name: 'Designer 2' },
Â  Â  Â  Â  ];
Â  Â  Â  Â  // ---------------------------------------------------------
Â  Â  Â  Â  
Â  Â  Â  Â  // --- TEMPORARY LOGIN CHECK (Will be removed upon real upgrade) ---
Â  Â  Â  Â  // Note: Designer 1 uses 'designer1@smile.com'. If you want to use the generic
Â  Â  Â  Â  // '1234' password for a real account, you must create it in Firebase Auth first.
Â  Â  Â  Â  // I'm using the email defined in the 'designers' array for consistency.
Â  Â  Â  Â  const DESIGNER_EMAIL = 'designer1@smile.com';

Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  currentUser = user;
Â  Â  Â  Â  Â  Â  Â  Â  // Redirect designers to their portal
Â  Â  Â  Â  Â  Â  Â  Â  if (designers.some(d => d.email === currentUser.email)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'designer-portal.html';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'portal-login.html';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  // ----------------------------------------------------------------------

Â  Â  Â  Â  async function loadData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const projectsRef = collection(db, 'projects');
Â  Â  Â  Â  Â  Â  Â  Â  const q = query(projectsRef, orderBy('createdAt', 'desc'));
Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await getDocs(q);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  allProjects = [];
Â  Â  Â  Â  Â  Â  Â  Â  for (const docSnap of snapshot.docs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = await loadFiles(docSnap.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allProjects.push({ id: docSnap.id, ...data, files });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadFiles(projectId) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const filesRef = ref(storage, `projects/${projectId}`);
Â  Â  Â  Â  Â  Â  Â  Â  const list = await listAll(filesRef);
Â  Â  Â  Â  Â  Â  Â  Â  const files = await Promise.all(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  list.items.map(async (item) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = await getDownloadURL(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const meta = await getMetadata(item);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: item.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  url,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  path: item.fullPath,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  size: meta.size,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: new Date(meta.timeCreated).toLocaleDateString()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  return files;
Â  Â  Â  Â  Â  Â  } catch {
Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function render() {
Â  Â  Â  Â  Â  Â  const stats = {
Â  Â  Â  Â  Â  Â  Â  Â  total: allProjects.length,
Â  Â  Â  Â  Â  Â  Â  Â  pending: allProjects.filter(p => p.status === 'pending').length,
Â  Â  Â  Â  Â  Â  Â  Â  inProgress: allProjects.filter(p => p.status === 'in-progress').length,
Â  Â  Â  Â  Â  Â  Â  Â  completed: allProjects.filter(p => p.status === 'completed').length
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const designerOptions = designers.map(d => 
Â  Â  Â  Â  Â  Â  Â  Â  `<option value="${d.email}">${d.name}</option>`
Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  document.getElementById('app').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <style>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body { font-family: system-ui, -apple-system, sans-serif; background: #000; color: #fff; min-height: 100vh; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .header { background: #1a1a1a; border-bottom: 1px solid rgba(56,189,248,0.2); padding: 20px; position: sticky; top: 0; z-index: 100; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .logo { font-size: 24px; font-weight: 600; display: flex; align-items: center; gap: 12px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .logo span { color: #38bdf8; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .admin-badge { background: rgba(139,92,246,0.2); color: #a78bfa; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid rgba(139,92,246,0.3); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .logout-btn { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); padding: 8px 20px; border-radius: 8px; cursor: pointer; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .main { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .page-title { font-size: 32px; margin-bottom: 8px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .page-subtitle { color: #9ca3af; margin-bottom: 40px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .stat-card { background: #1a1a1a; border: 1px solid rgba(56,189,248,0.2); border-radius: 16px; padding: 24px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .stat-label { color: #9ca3af; font-size: 14px; margin-bottom: 8px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .stat-value { font-size: 36px; font-weight: 600; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .section-title { font-size: 24px; font-weight: 600; margin-bottom: 24px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .projects-list { display: grid; gap: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .project-card { background: #1a1a1a; border: 1px solid rgba(56,189,248,0.2); border-radius: 16px; padding: 24px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .project-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .project-title { font-size: 20px; font-weight: 600; margin-bottom: 8px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .project-meta { color: #9ca3af; font-size: 14px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .status-select { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 6px 12px; color: #fff; font-size: 12px; cursor: pointer; }
                    .project-actions { display: flex; gap: 10px; } /* New style for grouping selects */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .project-desc { color: #d1d5db; margin-bottom: 20px; line-height: 1.6; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .btn-upload { background: linear-gradient(135deg, #0369a1, #38bdf8); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .files-section { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .files-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 12px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-info { display: flex; align-items: center; gap: 12px; flex: 1; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-icon { width: 40px; height: 40px; background: rgba(56,189,248,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-name { font-size: 14px; margin-bottom: 4px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-meta { color: #9ca3af; font-size: 12px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-actions { display: flex; gap: 8px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .btn-download { background: rgba(56,189,248,0.1); color: #38bdf8; border: 1px solid rgba(56,189,248,0.3); padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 12px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .btn-delete { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); overflow-y: auto; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .modal.active { display: flex; align-items: center; justify-content: center; padding: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .modal-content { background: #1a1a1a; border: 1px solid rgba(56,189,248,0.2); border-radius: 20px; padding: 40px; max-width: 600px; width: 100%; position: relative; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .close { position: absolute; right: 20px; top: 20px; font-size: 32px; color: #9ca3af; cursor: pointer; background: none; border: none; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .modal-title { font-size: 28px; margin-bottom: 10px; font-weight: 600; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .modal-subtitle { color: #9ca3af; font-size: 14px; margin-bottom: 30px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .upload-area { border: 2px dashed rgba(56,189,248,0.3); border-radius: 10px; padding: 40px; text-align: center; cursor: pointer; margin: 20px 0; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .upload-area:hover { border-color: #38bdf8; background: rgba(56,189,248,0.05); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-list { margin-top: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .file-list-item { display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .btn-remove { background: rgba(239,68,68,0.1); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .btn-primary { background: linear-gradient(135deg, #0369a1, #38bdf8); color: #fff; border: none; padding: 16px; border-radius: 50px; font-size: 18px; font-weight: 500; cursor: pointer; width: 100%; margin-top: 20px; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .status-msg { padding: 16px; border-radius: 10px; font-size: 14px; margin-top: 20px; display: none; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .status-msg.active { display: block; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .status-msg.success { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); color: #22c55e; }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .status-msg.error { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: #ef4444; }
Â  Â  Â  Â  Â  Â  Â  Â  </style>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="logo">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Smile <span>Center</span></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="admin-badge">ADMIN</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex; align-items: center; gap: 16px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="color: #9ca3af; font-size: 14px;">${currentUser ? currentUser.email : 'Loading...'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="logout-btn" onclick="logout()">Logout</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="main">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="page-title">Admin Panel</h1>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="page-subtitle">Manage all client projects, assign designers, and upload designs</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Total Projects</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value">${stats.total}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Pending</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value">${stats.pending}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">In Progress</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value">${stats.inProgress}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">Completed</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value">${stats.completed}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="section-title">All Projects</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${allProjects.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="projects-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${allProjects.map(project => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="project-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="project-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="project-title">${project.title}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="project-meta">
                                            Client: ${project.clientEmail} â€¢ Created ${new Date(project.createdAt).toLocaleDateString()}
                                            ${project.assignedDesignerEmail ? `<br>Assigned: ${project.assignedDesignerEmail}` : ''}
                                        </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="project-actions">
                                            <select class="status-select" onchange="updateDesigner('${project.id}', this.value)">
                                                <option value="" ${!project.assignedDesignerEmail ? 'selected' : ''}>ğŸ§‘â€ğŸ’» Unassigned</option>
                                                ${designers.map(d => `
                                                    <option value="${d.email}" ${project.assignedDesignerEmail === d.email ? 'selected' : ''}>
                                                        ğŸ§‘â€ğŸ’» ${d.name}
                                                    </option>
                                                `).join('')}
                                            </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="status-select" onchange="updateStatus('${project.id}', this.value)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="pending" ${project.status === 'pending' ? 'selected' : ''}>â³ Pending</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="in-progress" ${project.status === 'in-progress' ? 'selected' : ''}>ğŸ”„ In Progress</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>âœ… Completed</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
                                        </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${project.description ? `<div class="project-desc">${project.description}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-upload" onclick="openUpload('${project.id}')">ğŸ“¤ Upload Design Files</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${project.files.length > 0 ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="files-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="files-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: 500;">Project Files</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color: #9ca3af; font-size: 14px;">${project.files.length} files</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${project.files.map(file => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-icon">ğŸ“„</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-name">${file.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-meta">${formatSize(file.size)} â€¢ ${file.date}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="${file.url}" class="btn-download" download="${file.name}" target="_blank">â¬‡ï¸ Download</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-delete" onclick="deleteFile('${project.id}', '${file.path}', '${file.name}')">ğŸ—‘ï¸ Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : '<p style="color: #9ca3af; font-size: 14px;">No files yet</p>'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : '<p style="color: #9ca3af; text-align: center; padding: 60px;">No projects yet</p>'}
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="uploadModal" class="modal">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="close" onclick="closeUpload()">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="modal-title">ğŸ“¤ Upload Design Files</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="modal-subtitle">Upload your finished designs for the client</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="upload-area" onclick="document.getElementById('fileInput').click()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:48px; margin-bottom:16px;">ğŸ“</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:18px; font-weight:500; margin-bottom:8px;">Drag & drop files here</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color:#9ca3af; font-size:14px;">or click to browse</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" id="fileInput" multiple style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fileList" class="file-list"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="uploadStatus" class="status-msg"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary" id="uploadBtn" onclick="handleUpload()">Upload Files</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  // Setup file input
Â  Â  Â  Â  Â  Â  const fileInput = document.getElementById('fileInput');
Â  Â  Â  Â  Â  Â  if (fileInput) {
Â  Â  Â  Â  Â  Â  Â  Â  fileInput.addEventListener('change', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = Array.from(fileInput.files);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('fileList').innerHTML = files.map((f, i) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-list-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${f.name} (${formatSize(f.size)})</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-remove" onclick="removeFile(${i})">Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function formatSize(bytes) {
Â  Â  Â  Â  Â  Â  if (bytes === 0) return '0 Bytes';
Â  Â  Â  Â  Â  Â  const k = 1024;
Â  Â  Â  Â  Â  Â  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
Â  Â  Â  Â  Â  Â  const i = Math.floor(Math.log(bytes) / Math.log(k));
Â  Â  Â  Â  Â  Â  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
Â  Â  Â  Â  }

Â  Â  Â  Â  window.openUpload = (projectId) => {
Â  Â  Â  Â  Â  Â  currentProjectId = projectId;
Â  Â  Â  Â  Â  Â  document.getElementById('uploadModal').classList.add('active');
Â  Â  Â  Â  Â  Â  document.body.style.overflow = 'hidden';
Â  Â  Â  Â  };

Â  Â  Â  Â  window.closeUpload = () => {
Â  Â  Â  Â  Â  Â  document.getElementById('uploadModal').classList.remove('active');
Â  Â  Â  Â  Â  Â  document.body.style.overflow = 'auto';
Â  Â  Â  Â  Â  Â  document.getElementById('fileInput').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('fileList').innerHTML = '';
Â  Â  Â  Â  };

Â  Â  Â  Â  window.handleUpload = async () => {
Â  Â  Â  Â  Â  Â  const files = document.getElementById('fileInput').files;
Â  Â  Â  Â  Â  Â  if (files.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('Please select files', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const btn = document.getElementById('uploadBtn');
Â  Â  Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  Â  Â  btn.textContent = 'Uploading...';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  for (let file of files) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const storageRef = ref(storage, `projects/${currentProjectId}/${file.name}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await uploadBytesResumable(storageRef, file);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  showStatus('âœ… Files uploaded!', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeUpload();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  Â  Â  Â  Â  }, 1500);
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('âŒ Error: ' + error.message, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  btn.textContent = 'Upload Files';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.removeFile = (index) => {
Â  Â  Â  Â  Â  Â  const dt = new DataTransfer();
Â  Â  Â  Â  Â  Â  const input = document.getElementById('fileInput');
Â  Â  Â  Â  Â  Â  const files = Array.from(input.files);
Â  Â  Â  Â  Â  Â  files.splice(index, 1);
Â  Â  Â  Â  Â  Â  files.forEach(f => dt.items.add(f));
Â  Â  Â  Â  Â  Â  input.files = dt.files;
Â  Â  Â  Â  Â  Â  input.dispatchEvent(new Event('change'));
Â  Â  Â  Â  };

        // --- NEW FUNCTION: Update Designer Assignment ---
Â  Â  Â  Â  window.updateDesigner = async (projectId, newDesignerEmail) => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Update the Firestore document with the new designer's email
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, 'projects', projectId), { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assignedDesignerEmail: newDesignerEmail 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  await loadData(); // Reload data to reflect the change immediately
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Error updating designer assignment: ' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

        // --- EXISTING FUNCTION: Update Status ---
Â  Â  Â  Â  window.updateStatus = async (projectId, newStatus) => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await updateDoc(doc(db, 'projects', projectId), { status: newStatus });
Â  Â  Â  Â  Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Error updating status: ' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  window.deleteFile = async (projectId, filePath, fileName) => {
Â  Â  Â  Â  Â  Â  if (!confirm(`Delete ${fileName}?`)) return;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const fileRef = ref(storage, filePath);
Â  Â  Â  Â  Â  Â  Â  Â  await deleteObject(fileRef);
Â  Â  Â  Â  Â  Â  Â  Â  await loadData();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Error deleting file: ' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  function showStatus(msg, type) {
Â  Â  Â  Â  Â  Â  const el = document.getElementById('uploadStatus');
Â  Â  Â  Â  Â  Â  el.textContent = msg;
Â  Â  Â  Â  Â  Â  el.className = `status-msg active ${type}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  window.logout = async () => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = 'portal-login.html';
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Logout error:', error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  </script>
</body>
</html>
